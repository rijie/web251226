# 图片字幕生成器 PRD

## 一、产品概述
- 目标：提供一个将“多行字幕”叠加到图片底部并一次性生成新图片的网页工具。
- 关键特性：底部每一行字幕文字拥有“相同规格的背景条”，整体呈现清晰的切割感；文字支持描边、字体与粗细可选；所见即所得预览与一键导出。

## 二、用户场景与用户故事
- 用户希望给活动照、截图等添加多行说明文字，并保持专业的字幕视觉效果。
- 作为用户，我可以：
  - 上传一张本地图片并立即在右侧看到预览；
  - 在左侧配置字幕样式（高度、字号、颜色、描边、字体、粗细），并填写多行字幕内容；
  - 生成并下载带字幕的新图片；当生成成功时获得反馈提示。

## 三、信息架构与页面布局
- 页面头部：标题“图片字幕生成器”。
- 左侧区域（控制面板）：
  - 上传图片卡片：选择图片按钮 + 文件名展示。
  - 字幕设置卡片：字幕高度、字体大小、字体颜色、轮廓（描边）颜色、字体样式、字体粗细。
  - 字幕内容卡片：多行文本输入框。
  - 操作区按钮：生成字幕图片、保存图片。
- 右侧区域（预览面板）：
  - 画布预览：展示当前图片与字幕叠加效果。
  - 生成成功提示：底部浮层提示“图片生成成功！”。

## 四、核心功能与详细说明
### 4.1 上传图片
- 支持格式：JPEG、PNG、WEBP；大小限制与失败提示需明确（默认 10MB，可在实现阶段调整）。
- 上传后展示文件名；若再次选择图片，预览立即更新。
- 不进行服务器上传（本地处理），保障隐私。

### 4.2 字幕内容
- 输入框支持多行文字；以换行符分割为“多行字幕”。
- 单行过长时允许自动换行到“同一行的背景条宽度内”（详见 4.3 规则），避免溢出画布。
- 行顺序自上而下排列，整体靠近图片底部居中对齐。

### 4.3 字幕视觉与切割规则（重点）
- 每一行字幕文字背后都有一个“相同规格的背景条”，以形成整齐的切割感。
  - 背景条宽度：与“字幕区域”等宽（居中），所有行的背景条宽度一致。
  - 背景条高度：由“字幕高度”配置项控制，应用于每一行，保持一致。
  - 背景条颜色与透明度：默认为半透明深色（示例：rgba(0,0,0,0.6)），可在实现阶段开放配置（若需）。
  - 行间距：固定间距（示例：8px），保证明确的分隔与切割感。
  - 圆角：默认 0（直角矩形），确保硬朗的“切割感”；可在后续版本考虑圆角。
- 字幕区域位置：贴近图片底部，整体水平居中；与图片底边保留固定内边距（示例：24px）。
- 文本在各自背景条内水平居中、垂直居中排版；为保证易读，文本左右保留内边距（示例：24px）。
- 文本描边：支持开启，颜色由“轮廓颜色”配置；描边宽度默认 2px（可随字号按比例变化）。
- 颜色与可读性：文字颜色与背景形成明确对比（默认白字 + 黑描边）。

### 4.4 字幕样式设置
- 字幕高度（px）：控制“每行背景条”的高度；默认 80。
- 字体大小（px）：默认 40。
- 字体颜色：十六进制或颜色选择器，默认 #FFFFFF。
- 轮廓（描边）颜色：默认 #000000。
- 字体样式：下拉选择常见中文字体（如 微软雅黑、思源黑体、苹方 等），含安全回退方案。
- 字体粗细：正（Regular）、中（Medium）、粗（Bold）等。

### 4.5 预览与生成
- 左侧参数变更后，右侧预览实时刷新（延迟不超过 50ms）。
- 点击“生成字幕图片”：将当前预览渲染为最终图片（Canvas 导出为 PNG/JPEG）。
- 成功后显示提示：“图片生成成功！”；同时允许用户“保存图片”到本地。

### 4.6 保存与导出
- 导出格式：PNG（默认无损）与 JPEG（可在实现阶段加入质量选项）。
- 文件命名：默认“originalName_subtitle_时间戳”。支持用户手动重命名（可选）。

## 五、交互与状态反馈
- 上传成功：显示文件名；预览可用。
- 参数合法性校验：
  - 高度与字号为正整数且在阈值内（示例：1–300）。
  - 颜色值格式校验（#RRGGBB）。
  - 字幕内容为空时，禁用“生成字幕图片”并提示“请输入字幕内容”。
- 生成成功：绿色提示；失败显示错误原因（如图片过大、内存不足）。
- 按钮状态：处理过程中按钮置为“处理中”，避免重复触发。

## 六、技术实现建议
- 前端技术：原生 HTML5 Canvas 或 WebGL；优先 Canvas 以降低复杂度。
- 文本排版：
  - 先按用户换行拆分行；对每行执行“基于最大宽度的软换行”，确保文字不超出背景条宽度。
  - 使用 `measureText` 计算文字宽度；根据字号与字体粗细动态计算行高与描边宽度。
- 渲染步骤（Canvas）：
  1) 载入原图到画布；
  2) 计算字幕区域的总高度 = 行数 × 背景条高度 + 行间距 × (行数 - 1) + 底部内边距；
  3) 从底部向上逐行绘制背景条（等宽、等高、居中）；
  4) 在每个背景条内绘制文字（描边层 + 填充层），居中对齐；
  5) 导出为 PNG/JPEG Blob 并触发下载。
- 字体加载：使用 `@font-face` 或本地系统字体，提供回退链；在字体未就绪时展示加载状态。
- 性能与清晰度：支持高 DPI 导出（如 2x/3x 缩放），避免锯齿；长文案时启用分段计算与批量绘制。

## 七、兼容性与非功能性要求
- 浏览器：Chrome、Edge、Safari（最新两个大版本）；移动端视口下可用但以桌面端为主。
- 本地处理：不上传图片或文本到服务器（隐私友好）。
- 错误处理：统一错误提示组件；异常栈不暴露给用户。
- 可访问性：按钮与输入具备语义标签与键盘可操作性；颜色对比达标。

## 八、可配置项与默认值
- 字幕高度：默认 80px。
- 字体大小：默认 40px。
- 字体颜色：默认 #FFFFFF。
- 轮廓颜色：默认 #000000。
- 背景条颜色与透明度：默认 rgba(0,0,0,0.6)。
- 行间距：默认 8px。
- 字幕区域底部内边距：默认 24px。

## 九、验收标准
- 上传后可预览；参数修改实时生效。
- 生成的图片底部，所有字幕行的背景条宽度与高度一致，排列整齐，呈现清晰的“切割感”。
- 文本在背景条内居中并可读，白字黑描边默认清晰。
- 导出成功，文件可在本地打开且清晰无锯齿。
- 无网络上传行为；大图与长文案处理稳定，无明显卡顿或崩溃。

## 十、后续版本（可选）
- 自定义背景条颜色与透明度、圆角与阴影。
- 文字对齐方式（左/中/右）、行间距与字间距可调。
- 批量处理多张图片、模板保存与一键复用。

